<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Redirecting…</title>
    <script>
      (function () {
        var l = window.location;
        // Preserve the originally requested path and hash so SPA can restore it.
        var path = l.pathname || "/";
        var q = l.search ? "&q=" + l.search.slice(1).replace(/&/g, "~and~") : "";
        var h = l.hash || "";
        // Send user to root with ?p=<requestedPath>
        var target = l.origin + "/?p=" + encodeURIComponent(path) + q + h;
        l.replace(target);
      })();
    </script>
  </head>
  <body>Redirecting…</body>
</html>
